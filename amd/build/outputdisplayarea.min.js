define("qtype_coderunner/outputdisplayarea",["exports","jquery","core/ajax","core/str"],(function(_exports,_jquery,_ajax,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.OutputDisplayArea=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(langStringName,textarea,additionalText){var message;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,_str.get_string)(langStringName,"filter_ace_inline");case 2:message=_context.sent,textarea.show(),textarea.html(escapeHtml("*** "+message+" ***\n"+additionalText));case 5:case"end":return _context.stop()}}),_callee)})));var _ref,OutputDisplayArea=function(){function OutputDisplayArea(displayAreaId,outputMode){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,OutputDisplayArea),this.displayAreaId=displayAreaId,this.displayArea=document.getElementById(displayAreaId),this.textDisplay=document.getElementById(displayAreaId+"-text"),this.htmlDisplay=document.getElementById(displayAreaId+"-html"),this.imageDisplay=document.getElementById(displayAreaId+"-images"),this.mode=outputMode,this.stdIn=[]}var Constructor,protoProps,staticProps,_handleRunButtonClick;return Constructor=OutputDisplayArea,protoProps=[{key:"clearDisplay",value:function(){this.textDisplay.innerHTML="",this.htmlDisplay.innerHTML="",this.imageDisplay.innerHTML=""}},{key:"displayText",value:function(response){var output=response.output,error=response.stderr;this.textDisplay.innerText=output+error}},{key:"displayHtml",value:function(response){var output=response.output,error=response.stderr;this.textDisplay.innerHTML=output+error}},{key:"displayNoOutput",value:function(response){var isNoOutput=""===response.output&&""===response.stderr;return isNoOutput&&(this.textDisplay.innerHTML='<span style="color:red">&lt; No output! &gt;</span>'),isNoOutput}},{key:"display",value:function(response){if(!this.displayNoOutput(response))if("json"===this.mode){var json=JSON.parse(response);this.displayJson(json)}else if("html"===this.mode)this.displayHtml(response);else{if("text"!==this.mode)throw Error('Invalid outputMode given: "'.concat(this.mode,'"'));var text=response;this.displayText(text)}}},{key:"handleRunButtonClick",value:(_handleRunButtonClick=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(code,lang,sandboxParams){var _this=this;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:this.clearDisplay(),_ajax.default.call([{methodname:"qtype_coderunner_run_in_sandbox",args:{contextid:M.cfg.contextid,sourcecode:code,language:lang,params:JSON.stringify(sandboxParams)},done:function(responseJson){var response=JSON.parse(responseJson);_this.display(response)},fail:function(error){alert(error.message)}}]);case 2:case"end":return _context2.stop()}}),_callee2,this)}))),function(_x4,_x5,_x6){return _handleRunButtonClick.apply(this,arguments)})},{key:"displayJson",value:function(json){var _this2=this,result=json,text=result.stdout;42!==result.returncode&&(text+=result.stderr),13==result.returncode&&(text+="\n*** Timeout error ***\n");var base64,numImages=0;if(result.files)for(var prop in(0,_jquery.default)(this.imageDisplay).empty(),result.files){var image=(base64=result.files[prop],(0,_jquery.default)('<img src="data:image/png;base64,'.concat(base64,'">')));(0,_jquery.default)(this.imageDisplay).append(image),numImages+=1}if(""===text.trim()&&42!==result.returncode?0==numImages&&(0,_jquery.default)(this.textDisplay).html('<span style="color:red">&lt; No output! &gt;</span>'):(0,_jquery.default)(this.textDisplay).text(text),42===result.returncode){var inputId="".concat(this.displayAreaId,"-input-field");(0,_jquery.default)(this.textDisplay).html((0,_jquery.default)(this.textDisplay).html()+'<input type="text" id="'.concat(inputId,'">'));var inputEl=(0,_jquery.default)(document.getElementById(inputId));inputEl.focus(),inputEl.on("keyup",(function(e){if(13===e.keyCode){var line=inputEl.val();inputEl.remove(),(0,_jquery.default)(_this2.textDisplay).html((0,_jquery.default)(_this2.textDisplay).html()+line),_this2.handleRunButtonClick()}}))}}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),OutputDisplayArea}();_exports.OutputDisplayArea=OutputDisplayArea}));

//# sourceMappingURL=outputdisplayarea.min.js.map